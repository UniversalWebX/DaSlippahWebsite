<body>
  <!-- Your existing navbar and sections remain unchanged -->
  <nav class="navbar">
    <!-- ... all your existing nav code ... -->
  </nav>
  <section id="home" class="section active">
    <!-- ... all your existing sections ... -->
  </section>
  <!-- ... keep all your other sections exactly as they are ... -->

  <!-- ADMIN PANEL (hidden by default) -->
  <div id="adminPanel" style="display:none; position:fixed; top:50px; left:50px; width:420px; background:#000; color:#fff; padding:20px; border:2px solid #00ff00; border-radius:12px; z-index:100000; font-family: 'League Spartan', sans-serif; box-shadow:0 0 20px rgba(0,255,0,0.5);">
    <div id="dragHandle" style="cursor:move; text-align:center; font-size:1.4rem; margin-bottom:15px; color:#00ff00;">ADMIN PANEL - Drag Me</div>
    
    <div id="loginSection">
      <input type="text" id="adminUsername" placeholder="Admin Username" style="width:100%; padding:12px; margin-bottom:10px; background:#222; border:1px solid #00ff00; border-radius:6px; color:#fff; font-size:1rem;">
      <button onclick="loginAsAdmin()" style="width:100%; padding:12px; background:#00ff00; color:#000; border:none; border-radius:6px; cursor:pointer; font-weight:bold;">Login as Admin</button>
    </div>
    
    <div id="panelContent" style="display:none;">
      <h2 style="text-align:center; color:#00ff00; margin-bottom:20px;">DaSlippah Controls</h2>
      
      <div style="margin-bottom:25px;">
        <h3 style="color:#00ff00;">Client Changes</h3>
        <label>BG Color: <input type="color" onchange="document.body.style.background=this.value"></label><br><br>
        <label>Text Color: <input type="color" onchange="document.body.style.color=this.value"></label><br><br>
        <label>Gradient: <input type="text" placeholder="linear-gradient(...)" style="width:100%; padding:8px; background:#222; border:1px solid #555; color:#fff;" onchange="document.body.style.background=this.value"></label>
      </div>
      
      <div>
        <h3 style="color:#00ff00;">Server Commands</h3>
        <input type="text" id="commandInput" placeholder="e.g. announcement Site is live!" style="width:100%; padding:12px; background:#222; border:1px solid #00ff00; border-radius:6px; color:#fff; margin-bottom:10px;"
               onkeydown="if(event.key==='Enter') executeAdminCommand(this.value); this.value=''">
        <small style="color:#aaa;">Commands: kickall | banaccount {name} | announcement {msg} | releasedaslippah2trailer</small>
      </div>
    </div>
  </div>

  <!-- Your existing modals and content -->
  <div id="auth-modal" class="modal">...</div>
  <div id="watch-modal" class="modal">...</div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    let user = null, token = null, socket = io(), roomId = null, video = null;
    let isAdmin = false;

    // === ADMIN LOGIN ===
    function loginAsAdmin() {
      const username = document.getElementById('adminUsername').value.trim();
      if (username === 'DaSlippah') {
        isAdmin = true;
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('panelContent').style.display = 'block';
        socket.emit('registerUser', { username: 'DaSlippah' }); // Register as admin on server
        alert('Admin access granted!');
      } else {
        alert('Access denied.');
      }
    }

    // Toggle admin panel with \ key
    document.addEventListener('keydown', e => {
      if (e.key === '\\') {
        const panel = document.getElementById('adminPanel');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
      }
    });

    // Make admin panel draggable
    const panel = document.getElementById('adminPanel');
    const handle = document.getElementById('dragHandle');
    let dragging = false, startX, startY, initX, initY;
    handle.addEventListener('mousedown', e => {
      dragging = true;
      startX = e.clientX; startY = e.clientY;
      initX = panel.offsetLeft; initY = panel.offsetTop;
    });
    document.addEventListener('mousemove', e => {
      if (dragging) {
        panel.style.left = (initX + e.clientX - startX) + 'px';
        panel.style.top = (initY + e.clientY - startY) + 'px';
      }
    });
    document.addEventListener('mouseup', () => dragging = false);

    // === ADMIN COMMAND EXECUTION ===
    function executeAdminCommand(cmd) {
      const parts = cmd.trim().split(' ');
      const command = parts[0].toLowerCase();
      const arg = parts.slice(1).join(' ');

      if (command === 'releasedaslippah2trailer') {
        const grid = document.querySelector('.movies-grid');
        if (document.getElementById('daslippah2trailer')) return;
        const trailerCard = document.createElement('div');
        trailerCard.className = 'movie-card';
        trailerCard.id = 'daslippah2trailer';
        trailerCard.innerHTML = `
          <div class="poster trailer"><div class="gradient trailer"></div><h3>Da Slippah 2 Trailer</h3><span>EXCLUSIVE</span></div>
          <div class="info">
            <h3>Da Slippah 2 Trailer</h3>
            <iframe width="100%" height="315" src="https://drive.google.com/file/d/1h0Icjz7GLGsyrk-81aGMQuQMbc6bCLJd/preview" 
                    frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </div>
        `;
        grid.insertBefore(trailerCard, grid.querySelector('.coming'));
      } else if (isAdmin) {
        socket.emit('adminCommand', { command, arg }, response => {
          if (response && !response.success) alert('Error: ' + response.error);
        });
      } else {
        alert('Not authorized');
      }
    }

    // === SOCKET LISTENERS FOR SERVER EVENTS ===
    socket.on('announcement', msg => {
      const ann = document.createElement('div');
      ann.style.cssText = 'position:fixed;top:0;left:0;width:100%;background:#ff0000;color:#fff;text-align:center;padding:20px;font-size:1.8rem;z-index:999999;font-weight:bold;';
      ann.textContent = msg;
      document.body.appendChild(ann);
      setTimeout(() => ann.remove(), 20000);
    });

    socket.on('kicked', () => {
      alert('You have been kicked from Da Slippah.');
      location.reload();
    });

    socket.on('banned', () => {
      alert('Your account has been banned.');
      location.href = '/';
    });

    // === AFTER NORMAL USER LOGIN: Register socket identity ===
    // (Modify your existing handleAuth success block)
    // Find this part in your existing script and ADD the line:
    // socket.emit('registerUser', { username: user.username });

    // So inside the if (res.ok) block, after setting user/token:
    socket.emit('registerUser', { username: user.username });

    // Your existing code continues below (watchMovie, etc.)
    // ... keep all your existing functions (openModal, handleAuth, etc.) ...
    // Just make sure the registerUser emit is added after successful login

    // For clarity, here's the key addition in handleAuth:
    // Inside the res.ok block, after `user = data.user; token = data.token;`
    // ADD THIS LINE:
    socket.emit('registerUser', { username: user.username });

    // Rest of your existing script (watchMovie, chat, etc.)
    function watchMovie(movie) { /* your existing code */ }
    function watchTogether(movie) { /* your existing code */ }
    // ... etc ...
  </script>
</body>
